name: qxmledit # you probably want to 'snapcraft register <name>'
version: latest # just for humans, typically '1.2+git' or '1.3.2'
version-script: ./snap/scripts/getversion.sh
summary: QXmlEdit is a simple XML editor based on Qt libraries. # 79 char long summary
description: |
  QXmlEdit is a simple XML editor based on Qt libraries. Its main features are unusual data visualization modes, nice XML manipulation and presentation and it is multi platform. It can split very big XML files into fragments, and compare XML and XSD files. It was born on Google code (https://code.google.com/p/qxmledit).

grade: devel # must be 'stable' to release into candidate/stable channels
confinement: strict # use 'strict' once you have the right plugs and slots

icon: images/qxmledit.svg
architectures:
  - build-on: amd64
  - build-on: i386
  - build-on: arm64
apps:
  qxmledit:
    command: desktop-launch $SNAP/bin/qxmledit
    desktop: opt/qxmledit/QXmlEdit.desktop
    plugs:
      - desktop
      - desktop-legacy
      - wayland
      - unity7
      - opengl
      - home
      - removable-media
    environment:
      LD_LIBRARY_PATH: $LD_LIBRARY_PATH:$SNAP/opt/qxmledit/
parts:
  qxmledit:
    plugin: qmake
    qt-version: qt5
    options:
      - CONFIG+=release
    source: https://github.com/lbellonda/qxmledit.git
    source-branch: master
    source-type: git
    build-packages:
      - build-essential
      - libgl1-mesa-dev
      - mesa-common-dev
      - qttools5-dev-tools
      - qtdeclarative5-dev
      - libqt5svg5-dev
      - libqt5xmlpatterns5-dev
      - libqwtplot3d-qt5-dev
      - libqt5opengl5-dev
    override-build: |
      snapcraftctl build
      sed -i 's|Icon=qxmledit|Icon=\${SNAP}/meta/gui/icon.svg|' ${SNAPCRAFT_PART_INSTALL}/opt/qxmledit/QXmlEdit.desktop
    stage-packages:
      - libqt5svg5
      - libqt5xmlpatterns5
      - libqt5sql5-sqlite
      - libqt5sql5-mysql
      - libglu1-mesa
      - libqt5opengl5
      - libqt5printsupport5
      - libqt5xml5
      - libqwtplot3d-qt5-0
      - libgcc1
      - libqt5core5a
      - libqt5gui5
      - libqt5widgets5
      - libstdc++6
      - zlib1g
    filesets:
      exclude-x11-locales:
      - -usr/share/x11/locale/*
      exclude-changelogs:
      - -usr/share/doc/*/changelog*
    stage:
      - $exclude-x11-locales
      - $exclude-changelogs
      - -lib/x86_64-linux-gnu/libglib-2.0.so.0.4800.2
      - -lib/x86_64-linux-gnu/libpng12.so.0.54.0
      - -usr/lib/x86_64-linux-gnu/glib-2.0/gio-querymodules
      - -usr/lib/x86_64-linux-gnu/glib-2.0/glib-compile-resources
      - -usr/lib/x86_64-linux-gnu/glib-2.0/glib-compile-schemas
      - -usr/lib/x86_64-linux-gnu/libLLVM-6.0.so.1
      - -usr/lib/x86_64-linux-gnu/libcups.so.2
      - -usr/lib/x86_64-linux-gnu/libdrm.so.2.4.0
      - -usr/lib/x86_64-linux-gnu/libdrm_amdgpu.so.1.0.0
      - -usr/lib/x86_64-linux-gnu/libdrm_intel.so.1.0.0
      - -usr/lib/x86_64-linux-gnu/libdrm_nouveau.so.2.0.0
      - -usr/lib/x86_64-linux-gnu/libdrm_radeon.so.1.0.1
      - -usr/lib/x86_64-linux-gnu/libelf-0.165.so
      - -usr/lib/x86_64-linux-gnu/libgio-2.0.so.0.4800.2
      - -usr/lib/x86_64-linux-gnu/libgmodule-2.0.so.0.4800.2
      - -usr/lib/x86_64-linux-gnu/libgobject-2.0.so.0.4800.2
      - -usr/lib/x86_64-linux-gnu/libgthread-2.0.so.0.4800.2
      - -usr/lib/x86_64-linux-gnu/libjpeg.so.8.0.2
      - -usr/lib/x86_64-linux-gnu/libX11-xcb.so.1.0.0
      - -usr/lib/x86_64-linux-gnu/libX11.so.6.3.0
      - -usr/lib/x86_64-linux-gnu/libxkbcommon-x11.so.0.0.0
      - -usr/lib/x86_64-linux-gnu/libxkbcommon.so.0.0.0
    organize:
      opt/qxmledit/qxmledit: bin/qxmledit
      opt/qxmledit/QXmlEdit.appdata.xml: meta/gui/QXmlEdit.appdata.xml
      opt/qxmledit/sample.style: bin/sample.style
    after: [desktop-qt5]

